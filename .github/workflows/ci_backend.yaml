name: CI for backend
on:
  push:
    paths:
      - 'backend/**'
      - '.github/workflows/ci_backend.yaml'

jobs:
  check:
    name: check
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Cache Cargo's outputs
      uses: actions/cache@v2
      with:
        path: |
          ~/.cargo/bin/
          ~/.cargo/registry/index/
          ~/.cargo/registry/cache/
          ~/.cargo/git/db/
          backend/target
        key: ${{ runner.os }}-${{ hashFiles('backend/Cargo.lock') }}

    - name: Formatter
      run: |
        cargo fmt -- --check
      working-directory: ./backend

    - name: Check codes
      run: |
        cargo check
      working-directory: ./backend

    - name: Linter
      run: |
        cargo clippy
      working-directory: ./backend

    - name: Test
      run: |
        cargo test
      working-directory: ./backend

    # TODO
    # medium test
